{"version":3,"sources":["../src/index.js"],"names":["React","createContext","Consumer","Provider","shallowCompare","newObj","prevObj","key","propTypes","text","PropTypes","string","isRequired","options","any","WaterMarkProvider","props","drawerWatermark","canvas","document","createElement","defaultOptions","rotate","color","width","height","fontSize","fontAjust","offsetX","offsetY","ctx","getContext","textLength","length","rotatePI","Number","Math","PI","calcWidth","parseInt","cos","calcHeight","sin","textAlign","x","y","font","fillStyle","fillText","url","toDataURL","setState","state","nextProps","children","PureComponent","WaterMarkConsumer","cloneElement","style","Object","assign","backgroundImage","backgroundRepeat"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nconst { Consumer, Provider } = React.createContext(\"\");\n\nconst shallowCompare = (newObj, prevObj) => {\n  for (let key in newObj) {\n    if (newObj[key] !== prevObj[key]) return true;\n  }\n  return false;\n};\nconst propTypes = {\n  text: PropTypes.string.isRequired,\n  options: PropTypes.any\n};\n\nclass WaterMarkProvider extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      url: \"\"\n    };\n  }\n  componentDidMount() {\n    this.drawerWatermark(this.props);\n  }\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      nextProps.text !== this.props.text ||\n      shallowCompare(nextProps.options, this.props.options)\n    ) {\n      this.drawerWatermark(nextProps);\n    }\n  }\n\n  drawerWatermark = props => {\n    const canvas = document.createElement(\"canvas\");\n    const defaultOptions = {\n      rotate: 30,\n      color: \"rgba(0, 0, 0, 0.1)\",\n      width: 200,\n      height: 120,\n      fontSize: 12,\n      fontAjust: 1.2,\n      offsetX: 0,\n      offsetY: 0\n    };\n    const { text, options = defaultOptions } = props;\n    const {\n      rotate = defaultOptions.rotate,\n      color = defaultOptions.color,\n      width = defaultOptions.width,\n      height = defaultOptions.height,\n      fontSize = defaultOptions.fontSize,\n      fontAjust = defaultOptions.fontAjust,\n      offsetX = defaultOptions.offsetX,\n      offsetY = defaultOptions.offsetY\n    } = options;\n    const ctx = canvas.getContext(\"2d\");\n    const textLength = text.length * fontSize * fontAjust;\n    const rotatePI = (Number(rotate) / 180) * Math.PI;\n    const calcWidth = parseInt(textLength * Math.cos(rotatePI)) + offsetX;\n    const calcHeight = parseInt(textLength * Math.sin(rotatePI)) + offsetY;\n\n    const textAlign = {\n      x: 0,\n      y: calcHeight\n    };\n\n    canvas.width = calcWidth;\n    canvas.height = calcHeight;\n\n    if (!canvas.getContext) {\n      //你的浏览器不支持canvas!\n      return;\n    }\n\n    ctx.font = `${fontSize}px serif`;\n    ctx.rotate((-`${rotate}` * Math.PI) / 180); // 逆时针方向\n    ctx.fillStyle = color;\n    ctx.fillText(`${text}`, textAlign.x, textAlign.y);\n    const url = ctx.canvas.toDataURL();\n    this.setState({\n      url\n    });\n  };\n\n  render() {\n    return <Provider value={this.state.url}>{this.props.children}</Provider>;\n  }\n}\nWaterMarkProvider.propTypes = propTypes;\n\nconst WaterMarkConsumer = props => {\n  return (\n    <Consumer>\n      {url => {\n        return React.cloneElement(props.children, {\n          ...props,\n          style: Object.assign({}, props.style, {\n            backgroundImage: `url(${url})`,\n            backgroundRepeat: \"repeat\"\n          })\n        });\n      }}\n    </Consumer>\n  );\n};\n\nexport { WaterMarkProvider, WaterMarkConsumer, Consumer };\n"],"file":"index.js"}